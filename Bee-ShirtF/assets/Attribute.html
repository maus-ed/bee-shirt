<!DOCTYPE html>
<html lang="en" ng-app="MaterialApp">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quản lý Vật Liệu</title>
    <!-- Thêm CSS Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Thêm AngularJS -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.8.2/angular.min.js"></script>
</head>
<body ng-controller="materialController">
    <div class="container mt-4">
        <h2>Danh sách Vật Liệu</h2>

        <!-- Bảng hiển thị danh sách vật liệu -->
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th>Mã Vật Liệu</th>
                    <th>Tên Vật Liệu</th>
                    <th>Trạng Thái</th>
                    <th>Hành động</th>
                </tr>
            </thead>
            <tbody>
                <tr ng-repeat="material in materials">
                    <td>{{ material.codeMaterial }}</td>
                    <td>{{ material.nameMaterial }}</td>
                    <td>{{ material.statusMaterial == 1 ? 'Active' : 'Inactive' }}</td>
                    <td>
                        <button class="btn btn-warning" ng-click="editMaterial(material)">Xem Chi Tiết</button>
                        <button class="btn btn-danger" ng-click="deleteMaterial(material.codeMaterial)">Xóa</button>
                    </td>
                </tr>
            </tbody>
        </table>
        <div class="d-flex justify-content-center mt-4">
            <ul class="pagination">
                <!-- Nút Đầu -->
                <li class="page-item" ng-class="{'disabled': currentPage === 0}">
                    <button class="page-link" ng-click="goToPage(0)">Đầu</button>
                </li>
                
                <!-- Nút Previous -->
                <li class="page-item" ng-class="{'disabled': currentPage === 0}">
                    <button class="page-link" ng-click="goToPage(currentPage - 1)">Previous</button>
                </li>
        
                <!-- Các trang giữa -->
                <li class="page-item" ng-repeat="page in pages" ng-class="{'active': currentPage === page}">
                    <button class="page-link" ng-click="goToPage(page)">{{ page + 1 }}</button>
                </li>
        
                <!-- Nút Next -->
                <li class="page-item" ng-class="{'disabled': currentPage === totalPages - 1}">
                    <button class="page-link" ng-click="goToPage(currentPage + 1)">Next</button>
                </li>
        
                <!-- Nút Cuối -->
                <li class="page-item" ng-class="{'disabled': currentPage === totalPages - 1}">
                    <button class="page-link" ng-click="goToPage(totalPages - 1)">Cuối</button>
                </li>
            </ul>
        </div>

        <!-- Nút Mở Modal Thêm Vật Liệu -->
        <button class="btn btn-success" ng-click="openAddMaterialModal()" data-bs-toggle="modal" data-bs-target="#addMaterialModal">Thêm Vật Liệu</button>

        <!-- Modal Thêm Vật Liệu -->
        <div class="modal fade" id="addMaterialModal" tabindex="-1" aria-labelledby="addMaterialModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="addMaterialModalLabel">Thêm Vật Liệu</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <form ng-submit="saveNewMaterial()">
                            <div class="mb-3">
                                <label for="codeMaterial" class="form-label">Mã Vật Liệu:</label>
                                <input type="text" id="codeMaterial" ng-model="newMaterial.codeMaterial" class="form-control" required>
                            </div>
                            <div class="mb-3">
                                <label for="nameMaterial" class="form-label">Tên Vật Liệu:</label>
                                <input type="text" id="nameMaterial" ng-model="newMaterial.nameMaterial" class="form-control" required>
                            </div>
                            <div class="mb-3">
                                <label for="statusMaterial" class="form-label">Trạng Thái:</label>
                                <div>
                                    <label>
                                        <input type="radio" ng-model="newMaterial.statusMaterial" value="1"> Active
                                    </label>
                                    <label>
                                        <input type="radio" ng-model="newMaterial.statusMaterial" value="0"> Inactive
                                    </label>
                                </div>
                            </div>
                            <div class="d-flex justify-content-end">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                                <button type="submit" class="btn btn-primary ms-2">Thêm Vật Liệu</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal Sửa Vật Liệu -->
        <div class="modal fade" id="editMaterialModal" tabindex="-1" aria-labelledby="editMaterialModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="editMaterialModalLabel">Sửa Vật Liệu</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <form ng-submit="saveEditMaterial()">
                            <div class="mb-3">
                                <label for="codeMaterial" class="form-label">Mã Vật Liệu:</label>
                                <input type="text" id="codeMaterial" ng-model="material.codeMaterial" class="form-control" disabled>
                            </div>
                            <div class="mb-3">
                                <label for="nameMaterial" class="form-label">Tên Vật Liệu:</label>
                                <input type="text" id="nameMaterial" ng-model="material.nameMaterial" class="form-control" required>
                            </div>
                            <div class="mb-3">
                                <label for="statusMaterial" class="form-label">Trạng Thái:</label>
                                <div>
                                    <label>
                                        <input type="radio" ng-model="material.statusMaterial" value="1" ng-checked="material.statusMaterial === 1"> Hoạt Động
                                    </label>
                                    <label>
                                        <input type="radio" ng-model="material.statusMaterial" value="0" ng-checked="material.statusMaterial === 0"> Ngừng Hoạt Động
                                    </label>
                                </div>
                            </div>
                            <div class="d-flex justify-content-end">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                                <button type="submit" class="btn btn-primary ms-2">Cập nhật Vật Liệu</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal Confirm Xóa -->
        <div class="modal fade" id="confirmDeleteModal" tabindex="-1" aria-labelledby="confirmDeleteModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="confirmDeleteModalLabel">Xác Nhận Xóa</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <p>Bạn có chắc chắn muốn xóa vật liệu này?</p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Không</button>
                        <button type="button" class="btn btn-danger" ng-click="confirmDeleteMaterial()">Có</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Thêm JS Bootstrap 5 -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>

    <script>
       
var app = angular.module('MaterialApp', []);
app.service('materialService', ['$http', function($http) {
    this.getMaterials = function(page) {
        return $http.get(`http://localhost:8080/api/materials/list?page=${page}`);
    };

    this.getMaterialDetail = function(codeMaterial) {
        return $http.get(`http://localhost:8080/api/materials/detail/${codeMaterial}`);
    };

    this.addMaterial = function(material) {
        return $http.post('http://localhost:8080/api/materials/add', material);
    };

    this.updateMaterial = function(codeMaterial, material) {
        return $http.put(`http://localhost:8080/api/materials/update/${codeMaterial}`, material);
    };

    this.deleteMaterial = function(codeMaterial) {
        return $http.put(`http://localhost:8080/api/materials/delete/${codeMaterial}`);
    };
}]);

app.controller('materialController', ['$scope', 'materialService', function($scope, materialService) {
    $scope.materials = [];
    $scope.currentPage = 0;
    $scope.totalPages = 0;
    $scope.pages = [];
    $scope.material = {};
    $scope.newMaterial = {};
    $scope.confirmDelete = false;
    $scope.materialToDelete = null;

    $scope.getMaterials = function(page) {
        materialService.getMaterials(page).then(function(response) {
            $scope.materials = response.data.content.map(function(item) {
                return {
                    codeMaterial: item[0],
                    nameMaterial: item[1],
                    statusMaterial: item[2]
                };
            });
            $scope.totalPages = response.data.totalPages;
            $scope.pages = new Array($scope.totalPages);
        });
    };
    
    // Go to the next/previous page
    $scope.goToPage = function(page) {
        if (page >= 0 && page < $scope.totalPages) {
            $scope.currentPage = page;
            $scope.getMaterials($scope.currentPage);
        }
    };

    $scope.viewMaterialDetail = function(codeMaterial) {
        materialService.getMaterialDetail(codeMaterial).then(function(response) {
            $scope.material = response.data;
            $('#viewMaterialDetailModal').modal('show');
        });
    };

    // Close modal function
    $scope.closeModal = function(modalId) {
        $(`#${modalId}`).modal('hide');
    };

    $scope.openAddMaterialModal = function() {
        $scope.newMaterial = {};
    };

    $scope.saveNewMaterial = function() {
        materialService.addMaterial($scope.newMaterial).then(function(response) {
            $scope.getMaterials($scope.currentPage);
            $('#addMaterialModal').modal('hide');
            location.reload(); 
        });
    };

    $scope.editMaterial = function(material) {
        $scope.material = angular.copy(material);
        $('#editMaterialModal').modal('show');
    };

    $scope.saveEditMaterial = function() {
        materialService.updateMaterial($scope.material.codeMaterial, $scope.material).then(function(response) {
            $scope.getMaterials($scope.currentPage);
            $('#editMaterialModal').modal('hide');
        });
    };

    $scope.deleteMaterial = function(codeMaterial) {
        $scope.materialToDelete = codeMaterial;
        $('#confirmDeleteModal').modal('show');
    };

    $scope.confirmDeleteMaterial = function() {
        materialService.deleteMaterial($scope.materialToDelete).then(function(response) {
            $scope.getMaterials($scope.currentPage);
            $('#confirmDeleteModal').modal('hide');
        });
    };

    $scope.getMaterials($scope.currentPage);
}]);
</script>
</body>
</html>
